{% extends "base.html" %}

{% block title %}マイブログ{% endblock %}

{% block extra_head %}
<style>
    .blog-card {
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        border: 1px solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
    }
    .blog-card h3 {
        margin-top: 0;
        margin-bottom: 0.5rem;
    }
    .blog-card h3 a {
        text-decoration: none;
        color: inherit;
    }
    .blog-card h3 a:hover {
        color: var(--pico-primary);
    }
    .blog-meta {
        color: var(--pico-muted-color);
        font-size: 0.875rem;
        margin-bottom: 1rem;
    }
    .blog-content {
        margin-bottom: 1rem;
        white-space: pre-wrap;
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
    }
    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }
    .action-buttons button {
        margin: 0;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
    }
    .blog-tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }
    .blog-tag {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        background-color: var(--pico-primary);
        color: white;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 500;
        text-decoration: none;
    }
    .blog-tag:hover {
        opacity: 0.8;
    }
    .like-section {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    .like-section button {
        margin: 0;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
    }
    .like-count {
        color: var(--pico-muted-color);
        font-size: 0.875rem;
    }
</style>
{% endblock %}

{% block content %}
<a href="/blogs/register" role="button">新規投稿</a>

{% if pagination.items or pagination.current_page > 1 %}
    {% for post in pagination.items %}
    <div class="blog-card">
        <h3><a href="/blogs/{{ post.id }}/detail">{{ post.title }}</a></h3>
        <div class="blog-meta">
            投稿日時: {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}
            {% if post.updated_at != post.created_at %}
            | 更新日時: {{ post.updated_at.strftime('%Y-%m-%d %H:%M') }}
            {% endif %}
        </div>
        {% if post.tags %}
        <div class="blog-tags">
            {% for tag in post.tags %}
            <a href="/blogs/tag/{{ tag.id }}" class="blog-tag">{{ tag.name }}</a>
            {% endfor %}
        </div>
        {% endif %}
        <div class="blog-content">{{ post.content }}</div>
        <div class="like-section">
            {% if post.is_liked %}
            <form method="POST" action="/blogs/{{ post.id }}/unlike" style="margin: 0">
                <input type="hidden" name="redirect" value="/blogs/my?page={{ pagination.current_page }}">
                <button type="submit" class="secondary">いいね解除</button>
            </form>
            {% else %}
            <form method="POST" action="/blogs/{{ post.id }}/like" style="margin: 0">
                <input type="hidden" name="redirect" value="/blogs/my?page={{ pagination.current_page }}">
                <button type="submit" class="primary">いいね</button>
            </form>
            {% endif %}
            <span class="like-count">{{ post.like_count }} いいね</span>
        </div>
        <div class="action-buttons">
            <form method="GET" action="/blogs/{{ post.id }}/edit" style="margin: 0">
                <button type="submit" class="secondary">編集</button>
            </form>
            <form method="POST" action="/blogs/{{ post.id }}/delete" style="margin: 0">
                <button type="submit" class="secondary" onclick="return confirm('本当に削除しますか?')">削除</button>
            </form>
        </div>
    </div>
    {% endfor %}

{% if pagination.total_pages > 1 %}
<nav aria-label="ページネーション">
    <ul style="display: flex; gap: 0.5rem; list-style: none; padding: 0; justify-content: center;">
        {% if pagination.current_page > 1 %}
        <li><a href="?page={{ pagination.current_page - 1 }}" role="button" class="secondary">前へ</a></li>
        {% endif %}
        {% for p in range(1, pagination.total_pages + 1) %}
        <li><a href="?page={{ p }}" role="button" class="{% if p == pagination.current_page %}contrast{% else %}secondary{% endif %}">{{ p }}</a></li>
        {% endfor %}
        {% if pagination.current_page < pagination.total_pages %}
        <li><a href="?page={{ pagination.current_page + 1 }}" role="button" class="secondary">次へ</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% else %}
<p style="text-align: center;">まだブログを投稿していません。</p>
{% endif %}
{% endblock %}